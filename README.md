# NTP 

## ■NTPとは何ですか？その役割は何ですか？

  NTP（Network Time Protocol）代表网络时间协议。用于同步通过网络连接的设备的通信标准。

  NTP服务器也称为时间服务器，具有从可靠的时间源（例如铯原子钟）获取高精度时间的机制，同时向连接到网络的其他服务器提供时间信息。

  系统组件向NTP服务器发送时间信息请求时出现的微小时差会在服务器端进行纠正，从而实现精确的时间同步。


## ■NTPサーバーをどのように構成し管理しますか？

  这部分我没有理解是指的什么内容，只是在网上查到了不同OS下的NTP服务的设定方法作为记录参考。

- ### Windows设定

  - 右键单击 Windows 任务栏上出现时钟和日期的位置。
  - 右键单击并从出现的菜单中选择调整日期和时间。
  - 当日期和时间屏幕出现时，选择其他时钟。
  - 在“Internet 时间”选项卡上，选择“更改设置”。
  - 输入您要引用的 NTP 服务器的地址。示例：对于 nict，输入 ntp.nict.jp。
  - 选中与 Internet 时间服务器同步并选择立即更新。
  - 当显示消息“时钟已成功同步”时，选择“确定”完成。
 
- ### Mac设定

  - 单击 Apple 菜单并选择系统设置。
  - 从菜单中选择 通用。
  - 选择 日期和时间。
  - 从“日期和时间设置”屏幕中，选择“时间服务器”旁边的“设置”。
  - 输入您的触摸ID或密码进行解锁。
  - 将显示输入NTP服务器的屏幕，输入NTP服务器地址。示例：对于 nict：输入 ntp.nict.jp
  - 选择“完成”后，您将返回到日期和时间屏幕，并且将显示刚刚输入输入的NTP服务器地址。
 
- ### Linux设定

  - 终端输入```systemctl status chronyd``` 并按回车键。
  *如没有安装chrony，请使用yum命令安装，如下所示。
  ```
  yum install chrony
  ```

  - 使用status查看启动状态，如果未启动，则继续输入以下内容。
  ```
  systemctl enable chronyd
  ```

  - 再次输入```systemctl status chronyd```，如果启用了就OK了。
  
  - NTP服务器设置
  ```
  vi /etc/chrony.conf
  ```
  
  ```
  server ntp.nict.jp iburst
  port 0
  ```
  - .:wq保存输入的内容
  - chrony重新启动
  ```
  systemctl restart chronyd
  ```
  
  - chrony重新启动后，输入以下命令，当NTP服务器地址左侧显示*标记时，即完成。
  ```
  chronyc sources
  ```


## ■時間同期の重要性は何ですか？

  即使不使用 NTP 服务器，计算机也配备了计时器，因此它们可以保持恒定的时间。然而，准确性不是很好，在几周或几个月的时间里，它经常会偏差几秒钟或几分钟。
  
  对于个人出于爱好目的使用的计算机，有些人可能可以接受几秒或几分钟的差异，但对于作为互联网上的服务器的计算机来说，时间如果不准确，就可能会产生需要严重的问题。
  
  简单的从以下三点说明NTP服务器的重要性。
  
  - 系统连接时需要准确的时间
  
    
  企业系统通过与服务器和客户端终端连接来运行。
  
  当多个系统和应用程序协同工作时，如果各自的时间不同步，则任务的执行时序可能会出现偏差，从而导致意外行为。
  
  - 网络设备和服务器身份验证所必需的
  
  网络设备和服务器可以使用时间信息来执行认证。在 SSL/TLS 通信期间检查证书的到期日期时需要准确的时间。
  
  然而，如果来自互联网外部或内部的网络设备与服务器端设备的认证之间存在时间滞后，则用于彼此通信的协议可能无法正常工作，并且认证可能需要很长时间。
  
  - 发生故障时所需的准确时间
  
  当系统发生某种类型的故障时，需要收集错误日志等信息，识别故障位置，并从故障中恢复。
  
  但是，如果网络设备或服务器存在时间滞后，则很难确定哪个设备出现问题。
  
  因此，需要时间来确定故障原因，并且在此期间服务会停止，这对最终用户会产生负面影响。


## ■NTPサーバーの階層構造はどうなっていますか？

  NTP 服务器具有层次结构。每一层称为“Stratum”。
  
  使用GPS或原子钟的最可靠时间被定义为“Stratum0”，Stratum1 接收 Stratum0 的时间并将时间分配给较低层（Stratum2 及更高层）。当从 Stratum1 同步到较低层时，数字会增加到“Stratum2”和“Stratum3”，最多可达 Stratum16。当到达最低层“Stratum16”时，无法进行同步，因为没有更多层了。因此，最多可以将“Stratum15”作为 NTP 服务器进行同步。
  
  当然，层数越多，误差就越大。虽然理论上所有用户都在 Stratum1 上设置 NTP 是最好的，但如果每个人都在 Stratum1 上设置 NTP 服务器，就会出现过载问题。这是 NTP 服务器上的负载。
  
  如果 Stratum1 过载并发生故障，则分配准确的时间就没有意义。因此，为了分散负载，将NTP服务器设置为Stratum16，并采用分布式方式分配连接。
  
  （负载均衡和分布式部署）

  同一层级的设备可以对等相连，为对等组中的所有设备提供更健全稳定的时间。

  <img width="558" alt="スクリーンショット 2024-06-21 15 20 37" src="https://github.com/chaseDeil/LearningMemo/assets/16752412/6a3b3235-723b-44c5-8ac5-4b22a7966b8c">

